{% extends "base.html" %} {% block Content %}
<div class="bg-primary bg-gradient text-white py-5">
  <div class="container text-center py-5">
    <h1 class="display-3 fw-bold mb-3">üé¨ Welcome to Vidly</h1>
    <p class="lead mb-4">Your favorite movie collection in one place</p>
    <a href="{% url 'movie:index' %}" class="btn btn-warning btn-lg shadow">
      Browse Movies
    </a>
  </div>
</div>

<div class="container my-5">
  <div class="card shadow-lg border-0 rounded-4 p-4">
    <h2 class="text-center mb-4">ü§ñ AI Movie Recommendations</h2>

    <div class="mb-3">
      <input
        type="text"
        id="moviesInput"
        class="form-control form-control-lg"
        placeholder="Enter movies you like (e.g., Inception, Interstellar)"
      />
    </div>

    <button
      id="recommendBtn"
      class="btn btn-primary btn-lg w-100 mb-3"
      disabled
    >
      Get Recommendations
    </button>

    <div id="loading" class="text-center d-none">
      <div class="spinner-border text-primary" role="status"></div>
      <p class="mt-2 text-muted">Generating recommendations...</p>
    </div>

    <div id="results" class="mt-3"></div>
  </div>
</div>

<script>
  const input = document.getElementById("moviesInput");
  const btn = document.getElementById("recommendBtn");
  const results = document.getElementById("results");
  const loading = document.getElementById("loading");

  input.addEventListener("input", () => {
    btn.disabled = !input.value.trim();
  });

  btn.addEventListener("click", async () => {
    const movies = input.value.trim();
    results.innerHTML = "";
    btn.disabled = true;
    loading.classList.remove("d-none");

    try {
      const response = await fetch("{% url 'movie:ai_recommendations' %}", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ movies }),
      });
      const data = await response.json();

      if (data.recommendations) {
        results.innerHTML = `
          <div class="card bg-light">
            <div class="card-body">
              <h5 class="card-title">üìù Recommendations</h5>
              <textarea class="form-control" rows="10" readonly>${data.recommendations}</textarea>
            </div>
          </div>
        `;
      } else {
        results.innerHTML = `<div class="alert alert-danger">Error: ${data.error}</div>`;
      }
    } catch (error) {
      results.innerHTML = `<div class="alert alert-danger">Error: ${error.message}</div>`;
    } finally {
      loading.classList.add("d-none");
      btn.disabled = !input.value.trim();
    }
  });
</script>
{% endblock %}
